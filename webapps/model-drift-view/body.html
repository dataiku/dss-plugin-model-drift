<link rel="stylesheet" href="/plugins/model-drift/resource/style.css" />
<script src="/plugins/model-drift/resource/dku-helpers.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>


<div class="view-content" style="margin: 8px;">

<div style="width: 1000px">
    Data drift detection gives you insights on the applicability of a model by detecting when a new dataset differs
    from the one used for evaluation after training.
    <br>
    In order to detect this drift, we run a RandomForest classifier that aims at predicting the dataâ€™s origin. 
    If this drift detection model is successful in its task, this means that the two datasets can be distinguished from one another and that the data has drifted.
    <br>
    Provide a dataset on which you want to know if you can confidently apply this model.
    <div style="margin-top: 8px">
        <a href="https://www.dataiku.com/community/plugins/info/model-drift.html">Plugin documentation <i class="icon-external-link"></i></a>.
    </div>
</div>
<div style="margin: 16px 0;">
    Input dataset
    <select id="dataset-selector" style="width: 200px; margin: 0 8px;"></select>
    <a class="btn btn-primary notrunning-state" id="run-button" type="button">Run</a>
    <span class="running-state" style="display: none;">Running...</span>
</div>
<div id="error_message" style="width: 1000px; box-sizing: border-box; padding: 0;"></div>
<div class="result-state" style="display: none;">
    <div class="white-box">
        <div id="drift-explanation" class="explanation" style="float: right; width: calc(100% - 250px);">
        </div>
        <h2>Drift Score</h2>
        <div id="drift-score"></div>
    </div>

    <div class="white-box">
        <h2>Model Information</h2>

        <div style="margin-bottom: 32px">
            <div class="explanation" style="float: right; width: calc(100% - 550px);">
            Fugacity expresses the difference between expected and observed samples. We compare the proportion of samples predicted in each class when applying the model on both the original test and your input datasets. 
            </div>
            <h3>Fugacity</h3>
            <div id="fugacity-score"></div>
        </div>

        <div>
            <div class="explanation" style="float: right; width: calc(100% - 550px);">
                The density functions show the probability density of predicted rows in the test dataset (in the selected class) vs predicted rows in the selected dataset (in the selected class). 
                <br><br>The density chart illustrates how the original test dataset predicted probability distribution differs from that of the selected dataset. A highly drifted model fully separates the density functions.
            </div>
            <h3>
                Density chart
                <select id="label-list"></select>
            </h3>
            <div id="kde-chart"></div>
        </div>
    </div>

    <div class="white-box">
        <h2>Feature Drift Overview</h2>
        <div class="explanation" style="float: right; width: calc(100% - 550px);">
        The scatter plot shows how each features are important in the original model as well as in the drift detection model.<br><br> 
        On the x-axis is the drift feature importance, i.e. the feature importance in the drift detection model.<br><br> 
        The closer the point is to the right, the more the feature was important in the drift model. On the y-axis is the original feature importance ranking.<br><br>
        
            <b>This graph should be examined alongside with the drift score</b>. For example, given a highly drifted dataset (drift score ~1), if the most important features 
        that drive the drift are not significant in the original model (low importance in the original one), you can expect the behavior of the model to still be the same.<br><br>
        On the contrary, in a situation with a high drift score and where the impacted features are important in the original model (ie. some points are on the top right of this graph),
        the performance of the model will probably change on the new test set.    
        </div>
        <div id="feat-imp-plot"></div>
    </div>
</div>

</div>
